<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <title>Profile</title>
    <link rel="stylesheet" href="../Styles/profile.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <nav>    
        <input type="checkbox" id="sidebar-active">
        <label for="sidebar-active" class="open-sidebar-button">
            <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>
        </label>
    
        <div class="side-list">
            <label id="overlay" for="sidebar-active"></label>
            <label for="sidebar-active" class="close-sidebar-button">
                <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
            </label>
    
            <ul class="login">
                <li><a href="../HTML/login.html"><i class="fa-solidc fa-right-to-bracket"></i>Login</a></li>
            </ul>
    
            <ul class="base_list">
                <div class="moon" style="display: flex; align-items: center; gap: .5vw; margin-left: 2vw; margin-top: 1vw;">
                    <img class="mooon" src="/ROWAD/Media/moon.png" alt="">
                    <p>Theme</p>
                </div>
                <!-- <li><a href=""><i class="fa-solid fa-house"></i>Home</a></li> -->
                <li><a href="../HTML/profile.html"><i class="fa-regular fa-address-card"></i>Profile</a></li>
                <li><a href="../HTML/AboutUs.html"><i class="fa-solid fa-info"></i>About</a></li>
                <li><a href="../HTML/ContactUs.html"><i class="fa-solid fa-inbox"></i>Contac us</a></li>
            </ul>
    
            <ul class="service_list">
                <li><a href="../HTML/BusinessRecommendation.html"><i class="fa-solid fa-tag"></i>Business Recommendations</a></li>
                <li><a href="../HTML/InteriorDesign.html"><i class="fa-solid fa-tag"></i>Interior Design</a></li>
                <li><a href="../HTML/businessIdentity.html"><i class="fa-solid fa-tag"></i>Business Identity</a></li>
                <li><a href="../HTML/FinancialAnalysis.html"><i class="fa-solid fa-tag"></i>Financial Analysis</a></li>
            </ul>
    
            <ul class="logout">
                <li id="logoutAction1" style="cursor: pointer"><i class="fa-solid fa-right-from-bracket"></i>Logout</li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h4 class="font-weight-bold py-2 mb-3">
            Account settings
        </h4>
        <div class="card overflow-hidden">
            <div class="row no-gutters row-bordered row-border-light">
                <div class="col-md-3 pt-0">
                    <div class="list-group list-group-flush account-settings-links">
                        <a class="list-group-item list-group-item-action active" data-toggle="list"
                            href="#account-general">General</a>
                        <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-change-password">Change password</a>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="account-general">
                            
                            <div class="card-body">
                                <div class="form-group row">
                                    <div class="col-md-6">
                                        <label class="form-label">Username</label>
                                        <input name="username" id="update_username" type="text" class="form-control" placeholder="suhhha123">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Fullname</label>
                                        <input name="name" id="update_name" type="text" class="form-control" placeholder="Suha Alsulami">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-6">
                                        <label class="form-label">E-mail</label>
                                        <input name="email" type="email" id="update_useremail" class="form-control" placeholder="suha@mail.com">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Phone Number</label>
                                        <input name="PhoneNo" id="update_phone" type="text" class="form-control" placeholder="05* *** ****">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Address</label>
                                    <textarea name="Address" id="update_address" class="form-control" rows="3" placeholder="123 Falah St, Jeddah"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="account-change-password">
                            <div class="card-body pb-2">
                                <div class="form-group">
                                    <label class="form-label">Enter Your Email</label>
                                    <input id="useremail" placeholder="myemail@gmail.com" type="email" required class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Current password</label>
                                    <input id="currentPass" type="password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">New password</label>
                                    <input id="NewPass" type="password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Repeat new password</label>
                                    <input id="confirmPass" type="password" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-right mt-3">
            <button type="button" class="btn btn-primary" id="save_pass">Update Password</button>&nbsp;
            <button type="button" class="btn btn-primary" id="save_change">Save changes</button>&nbsp;
            <button type="button" class="btn btn-default">Cancel</button>
        </div>
    </div>
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
 document.addEventListener("DOMContentLoaded", function () {
    let useremail = document.getElementById("useremail");
    let oldpass = document.getElementById("currentPass");
        let newpass = document.getElementById("NewPass");
        let confirmpass = document.getElementById("confirmPass");
        let save_pass = document.getElementById("save_pass");
        save_pass.addEventListener("click", async function () {
                let profile = {
                    email:useremail.value,
                    oldPassword:oldpass.value,
                    newPassword:newpass.value,
                    confirmPassword:confirmpass.value
                }

                ///
                
                let response = await fetch('http://localhost:3001/api/v1/password/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(profile)
    });
  
    let data = await response.json();
  
    // Handle the response here. For example:
    if (data.success==true) {
        // Login successful
        alert("Passwords updated successfully")
    } else {
      // Login failed   
      alert("An error occurred, please try again later");
    }
                ////
            })
        
 });
        
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let profile_name = document.getElementById("update_name");
            let profile_username = document.getElementById("update_username");
            let profile_email = document.getElementById("update_useremail");
            let profile_phone = document.getElementById("update_phone");
            let profile_address = document.getElementById("update_address");

            let save_change = document.getElementById("save_change");

            save_change.addEventListener("click", async function () {
                let profile = {
                    // avatar: profile_avatar.value,
                    name: profile_name.value,
                    username: profile_username.value,
                    email: profile_email.value,
                    PhoneNo: profile_phone.value,
                    Address: profile_address.value
                }

                ///
                let response = await fetch('http://localhost:3001/api/v1/me/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(profile)
    });
  
    let data = await response.json();
  
    // Handle the response here. For example:
    if (data.success) {
        // Login successful
        alert("Profile updated successfully")
    } else {
      // Login failed   
      alert("An error occurred, please try again later");
    }
                ////
            })
        })

            let logoutbtn1 = document.getElementById('logoutAction1');


logoutbtn1?.addEventListener('click', async function() {
    let response = await fetch('http://localhost:3001/api/v1/logout', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      },
    });
  
    let data = await response.json();
  
    // Handle the response here. For example:
    try {
      if (data.success) {
        localStorage.removeItem('token');
        document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        alert("Logged out successfully");
      }
    } catch (error) {
      alert("Error: " + error)
      alert(error.message);
    }
});
      
    </script>
<script src="../JS/login_and_sign_up.js"></script>
    <script src="/ROWAD/JS/script.js"></script>
</body>

</html>

